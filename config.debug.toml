api_port = 9200

# ── Format ─────────────────────────────────────────────────────
[[formats]]
name = "json"
plugin = "target/debug/libcodec_json.so"

# ── Topic (1 message in memory) ───────────────────────────────
[[topics]]
name = "debug"
format = "json"
storage = "memory"
buffer = 16
overflow = "drop"
[topics.storage_config]
max_records = 1

# ── Source: TCP :9100  →  topic "debug" ───────────────────────
# echo '{"symbol":"TEST","bid":1.23,"ask":1.24,"ts_ms":1700000000000}' | nc localhost 9100
[[sources]]
name = "tcp-in"
topic = "debug"
transport = "target/debug/libtransport_tcp_server.so"
framing = "target/debug/libframing_lines.so"
codec = "target/debug/libcodec_json.so"
buffer = 16
overflow = "back_pressure"
[sources.transport_config]
port = 9100

# ── Sink: topic "debug"  →  TCP :9300 ────────────────────────
# nc localhost 9300
[[sinks]]
name = "tcp-out"
topics = ["debug"]
transport = "target/debug/libtransport_tcp_server.so"
framing = "target/debug/libframing_lines.so"
codec = "target/debug/libcodec_json.so"
buffer = 16
overflow = "drop"
[sinks.transport_config]
port = 9300
