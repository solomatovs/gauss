services:
  grafana-quotes-datasource-build:
    build:
      context: ../../..
      dockerfile: bins/grafana-datasource/build/Dockerfile.build
    container_name: grafana-quotes-datasource-build
    restart: "no"

    # Copy built plugin artifacts to the output directory and deploy to Grafana
    entrypoint: >
      /bin/sh -c "
      echo 'Building plugin artifacts...';
      rm -rf /out/*;
      cp -r /plugin/quotes-datasource/* /out/;
      echo 'Deploying plugin to Grafana...';
      rm -rf /grafana-plugins/quotes-datasource;
      cp -r /plugin/quotes-datasource /grafana-plugins/quotes-datasource;
      echo 'Plugin deployed successfully';
      ls -la /grafana-plugins/quotes-datasource;
      "

    volumes:
      - ./out:/out
      - ../../../../grafana/data/plugins:/grafana-plugins
